<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ุงูุฌุฒุงุฆุฑ ุงูุฎุถุฑุงุก โ ููุตุฉ ูุชูุฏูุฉ ูููุณุงููุงุช ุงูุจูุฆูุฉ</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster-src.js"></script>
<script src="https://unpkg.com/simpleheat/simpleheat.js"></script>
<script src="https://unpkg.com/leaflet.heat/dist/leaflet-heat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;800&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>


    <link rel="stylesheet" href="../css/map.css">
</head>
<body>

<div class="app" role="application" aria-label="Algรฉrie Verte">

  <aside class="sidebar" id="sidebar" aria-labelledby="title">
    <div class="brand">
      <div class="logo">๐ณ</div>
      <div>
        <h1 id="title">ุงูุฌุฒุงุฆุฑ ุงูุฎุถุฑุงุก</h1>
        <p>ููุตุฉ ูุชูุฏูุฉ ูููุณุงููุงุช ุงูุจูุฆูุฉ</p>
      </div>
    </div>

    <button class="sidebar-close" onclick="toggleSidebar(false)" aria-label="Fermer la barre latรฉrale"><i class="fas fa-times"></i></button>

    <div class="mobile-nav" id="mobileNav">
        <div class="mobile-nav-item active" data-target="form-panel" onclick="switchPanel('form-panel', this)"><i class="fas fa-plus-circle"></i> ุฅุถุงูุฉ ุดุฌุฑุฉ</div>
        <div class="mobile-nav-item" data-target="list-panel" onclick="switchPanel('list-panel', this)"><i class="fas fa-list-ul"></i> ุงููุณุงููุงุช</div>
        <div class="mobile-nav-item" data-target="stats-panel" onclick="switchPanel('stats-panel', this)"><i class="fas fa-chart-bar"></i> ุงูุฅุญุตุงุกุงุช</div>
        <div class="mobile-nav-item" data-target="detail-panel" id="detailNav" style="display:none;" onclick="switchPanel('detail-panel', this)"><i class="fas fa-eye"></i> ุงูุชูุงุตูู</div>
    </div>

    <div class="sidebar-content">
        <div class="panel mobile-panel" id="form-panel">
          <h3 id="form-title">ุณุฌู ุดุฌุฑุชู ุงูุฌุฏูุฏุฉ</h3>
          <form id="treeForm" onsubmit="event.preventDefault(); handleSubmit();" aria-live="polite">
            <div class="field">
              <label for="nom">ุงูุงุณู ุงููุงูู / ุงูุฌูุฉ <span class="required">*</span></label>
              <input id="nom" name="nom" type="text" placeholder="ูุซุงู: ูุญูุฏ ุจู โ ุฌูุนูุฉ ุฒุฑุงุนุฉ" required aria-required="true" />
              <div class="help-text">
                <i class="fas fa-lightbulb"></i>
                <span>ููููู ุฅุฏุฎุงู ุงุณูู ุงูุดุฎุตู ุฃู ุงุณู ุงูุฌูุนูุฉ/ุงููุคุณุณุฉ</span>
              </div>
            </div>
            <div class="field">
              <label for="adresse">ุงูููุทูุฉ / ุงูุนููุงู (ุงุฎุชูุงุฑู)</label>
              <input id="adresse" name="adresse" type="text" placeholder="ููุงูุฉุ ุจูุฏูุฉุ ุฃู ูุตู ุฏููู" />
              <div class="help-text">
                <i class="fas fa-map-marker-alt"></i>
                <span>ูุณุงุนุฏ ูุฐุง ุงูุญูู ูู ุชุญุฏูุฏ ุงููููุน ุจุดูู ุฃูุถู</span>
              </div>
            </div>
            <div class="row">
              <div class="col field">
                <label for="type_arbre">ููุน ุงูุดุฌุฑุฉ <span class="required">*</span></label>
                <select id="type_arbre" required aria-required="true">
                  <option value="">ุงุฎุชุฑ ููุน</option>
                  <option>ุตููุจุฑ ุญูุจู</option>
                  <option>ุฃุฑุฒ ุงูุฃุทูุณ</option>
                  <option>ุฒูุชูู</option>
                  <option>ูุฎูู</option>
                  <option>ุจููุท</option>
                  <option>ุฃุฎุฑู</option>
                </select>
              </div>
              <div class="col field">
                <label for="quantite">ุนุฏุฏ ุงูุฃุดุฌุงุฑ ุงููุฒุฑูุนุฉ <span class="required">*</span></label>
                <input id="quantite" type="number" min="1" placeholder="ุงูุนุฏุฏ" required aria-required="true" value="1" />
              </div>
            </div>
            <div class="row">
              <div class="col field">
                <label for="date_planted">ุชุงุฑูุฎ ุงูุฒุฑุน</label>
                <input id="date_planted" type="date" />
              </div>
            </div>
            <div class="field">
              <label for="photo">ุตูุฑุฉ ุจุนุฏ ุงูุฒุฑุน (ุงุฎุชูุงุฑู)</label>
              <input id="photo" type="file" accept="image/*" />
              <img id="preview" class="preview" alt="ูุนุงููุฉ ุงูุตูุฑุฉ" style="display:none;" />
              <div class="help-text">
                <i class="fas fa-camera"></i>
                <span>ุฃุถู ุตูุฑุฉ ููุดุฌุฑุฉ ุงููุฒุฑูุนุฉ ูุชูุซูู ุฃูุถู. ุงูุตูุบ ุงููุฏุนููุฉ: JPG, PNG, WebP</span>
              </div>
            </div>
            <div class="field location-group">
              <label>ูููุน ุงูุฒุฑุน <span class="required">*</span></label>
              <div class="row coords-inputs">
                <input id="latitude" type="text" readonly placeholder="ุฎุท ุงูุนุฑุถ" required aria-required="true" />
                <input id="longitude" type="text" readonly placeholder="ุฎุท ุงูุทูู" required aria-required="true" />
              </div>
              <div class="help-message">
                <i class="fas fa-info-circle"></i>
                <span id="locationHelpText">ุงุณุชุฎุฏู ุฒุฑ "ุชุญุฏูุฏ ูููุนู" ูุชุญุฏูุฏ ูููุนู ุชููุงุฆูุงูุ ุฃู "ุงุฎุชุฑ ุนูู ุงูุฎุฑูุทุฉ" ุซู ุงููุฑ ุนูู ุงูุฎุฑูุทุฉ ูุชุญุฏูุฏ ุงููููุน.</span>
              </div>
            </div>
            <div class="form-button-group">
              <button type="button" class="btn primary" id="geolocationBtn" aria-label="ุชุญุฏูุฏ ูููุนู ุงูุญุงูู">
                <i class="fas fa-location-arrow"></i> ุชุญุฏูุฏ ูููุนู
              </button>
              <button type="button" class="btn secondary" id="selectOnMapBtn" aria-label="ุงุฎุชุฑ ุนูู ุงูุฎุฑูุทุฉ">
                <i class="fas fa-map-marker-alt"></i> ุงุฎุชุฑ ุนูู ุงูุฎุฑูุทุฉ
              </button>
              <button type="submit" class="btn secondary" title="ุฃุถู ุงูุดุฌุฑุฉ" disabled aria-disabled="true">
                <i class="fas fa-plus-circle"></i> ุฅุถุงูุฉ ุดุฌุฑุฉ
              </button>
              <button type="button" class="btn ghost small-action" onclick="resetForm();" aria-label="ูุณุญ ุงูุญููู">
                <i class="fas fa-redo"></i> ุฅุนุงุฏุฉ ุชุนููู
              </button>
            </div>
            <div id="formMessage" role="status" aria-live="polite" style="display: none;"></div>
          </form>
        </div>

        <div class="panel mobile-panel" id="stats-panel" style="display:none;">
          <h3 id="stats-title">ุฅุญุตุงุกุงุช ูุฃุฏูุงุช</h3>
          <div class="list-title">
            <strong>ุฅุญุตุงุก ุณุฑูุน</strong>
            <small class="muted" id="lastUpdate">โ</small>
          </div>
          <div class="stat-grid">
            <div class="stat-item" role="status" aria-live="polite">
              <strong id="stat-total-trees">0</strong>
              <div class="muted">ูุฌููุน ุงูุฃุดุฌุงุฑ ุงููุฒุฑูุนุฉ</div>
            </div>
            <div class="stat-item">
              <strong id="stat-count">0</strong>
              <div class="muted">ูุฌููุน ุงููุณุงููุงุช (ููุงุท)</div>
            </div>
            <div class="stat-item">
              <strong id="stat-types">0</strong>
              <div class="muted">ุฃููุงุน ุงูุฃุดุฌุงุฑ</div>
            </div>
          </div>

          <div class="filter-group">
            <input id="quickSearch" placeholder="ุงุจุญุซ ุจุงูุงุณูุ ุงููููุนุ ุฃู ุงูููุน..." oninput="debouncedSearch()" aria-label="ุจุญุซ ุณุฑูุน" />
            <select id="sortOrder" onchange="applyFiltersAndSort()" aria-label="ุชุฑุชูุจ ุญุณุจ">
                <option value="createdAt">ุงูุฃุญุฏุซ ุฃููุงู</option>
                <option value="nom">ุชุฑุชูุจ ุฃุจุฌุฏู (ุงูุงุณู)</option>
                <option value="type">ุชุฑุชูุจ ุฃุจุฌุฏู (ุงูููุน)</option>
            </select>
            <select id="typeFilter" onchange="applyFiltersAndSort()" aria-label="ููุชุฑ ุญุณุจ ููุน ุงูุดุฌุฑุฉ">
                <option value="">ูู ุงูุฃููุงุน</option>
                <option>ุตููุจุฑ ุญูุจู</option>
                <option>ุฃุฑุฒ ุงูุฃุทูุณ</option>
                <option>ุฒูุชูู</option>
                <option>ูุฎูู</option>
                <option>ุจููุท</option>
                <option>ุฃุฎุฑู</option>
            </select>
          </div>

          <div class="panel-footer-actions" style="margin-top:20px;">
            <div class="list-title"><strong>ุฅุฏุงุฑุฉ ุงูุจูุงูุงุช</strong></div>
            <div class="file-actions" style="display:flex; gap:8px;">
              <button class="btn ghost" onclick="exportData()" aria-label="ุชุตุฏูุฑ ุงูุจูุงูุงุช ุจุตูุบุฉ JSON"><i class="fas fa-download"></i> ุชุตุฏูุฑ (JSON)</button>
              <input id="importFile" type="file" accept="application/json" style="display:none" onchange="importData(event)" aria-label="ุงุณุชูุฑุงุฏ ููู JSON">
              <button class="btn ghost" onclick="document.getElementById('importFile').click()" aria-label="ุงุณุชูุฑุงุฏ ุจูุงูุงุช JSON"><i class="fas fa-file-import"></i> ุงุณุชูุฑุงุฏ</button>
              <button class="btn danger" onclick="clearAllData()" aria-label="ูุณุญ ูู ุงูุจูุงูุงุช"><i class="fas fa-trash-alt"></i> ูุณุญ ุงููู</button>
            </div>
            <small class="muted" style="margin-top:8px; display:block;">ุชุตุฏูุฑ/ุงุณุชูุฑุงุฏ ูุญูุธ ุจูุงูุงุช ุงูุฎุฑูุทุฉ ูุญูููุง.</small>
          </div>

          <div class="remote-sample" aria-live="polite">
            <h4>ูุนุงููุฉ ุตูุฑุฉ ูู MongoDB</h4>
            <p class="muted">ูููู ุจุฌูุจ ุขุฎุฑ ูุณุงููุฉ ูู ุงูุฎุงุฏู ููุชุฃูุฏ ูู ุฃู ุงูุตูุฑ ูุญููุธุฉ ูุชุธูุฑ ุจุดูู ุตุญูุญ.</p>
            <img id="remoteSamplePhoto" class="detail-img" alt="ุตูุฑุฉ ูุณุงููุฉ ูุญููุฉ ูู MongoDB" style="display:none;" />
            <small id="remoteSampleInfo" class="muted" style="display:none;"></small>
            <button type="button" class="btn ghost" onclick="loadRemoteSample()" style="margin-top:12px;">
              <i class="fas fa-sync-alt"></i> ุชุญุฏูุซ ุงููุนุงููุฉ
            </button>
          </div>
        </div>

        <div class="panel panel-list mobile-panel" id="list-panel" style="display:none;">
          <h3 id="list-title">ูุงุฆูุฉ ุงููุณุงููุงุช</h3>
          <div class="list-title">
            <strong>ุงููุชุงุฆุฌ (<span id="resultsCount">0</span>)</strong>
            <small id="filterInfo">ุงููู</small>
          </div>
          <div id="locationsList" style="flex-grow:1;" role="list"></div>
        </div>

        <div class="panel mobile-panel" id="detail-panel" style="display:none;">
            <div class="detail-header">
                <h3 id="detail-title">ุชูุงุตูู ุงููุณุงููุฉ</h3>
                <button class="btn icon-only primary" title="ุชุนุฏูู" onclick="openEditModal(this.dataset.id)" data-id="" id="detailEditBtn">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn icon-only danger" title="ุญุฐู" onclick="removeEntry(this.dataset.id); switchPanel('list-panel');" data-id="" id="detailDeleteBtn">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
            
            <img id="detail-photo" class="detail-img" alt="ุตูุฑุฉ ูููุณุงููุฉ" src="https://via.placeholder.com/400x200?text=No+Image" />

            <div class="detail-meta-item">
                <strong>ููุน ุงูุดุฌุฑุฉ</strong>
                <span id="detail-type">-</span>
            </div>
            <div class="detail-meta-item">
                <strong>ุงูุนุฏุฏ</strong>
                <span id="detail-quantite">-</span>
            </div>
            <div class="detail-meta-item">
                <strong>ุงูุฒุงุฑุน / ุงูุฌูุฉ</strong>
                <span id="detail-nom">-</span>
            </div>
            <div class="detail-meta-item">
                <strong>ุงูุนููุงู / ุงูููุทูุฉ</strong>
                <span id="detail-adresse">-</span>
            </div>
            <div class="detail-meta-item">
                <strong>ุงููุฏููุฉ</strong>
                <span id="detail-city">-</span>
            </div>
            <div class="detail-meta-item">
                <strong>ุงูุญู / ุงูููุงุทุนุฉ</strong>
                <span id="detail-district">-</span>
            </div>
            <div class="detail-meta-item">
                <strong>ุชุงุฑูุฎ ุงูุฒุฑุน</strong>
                <span id="detail-date">-</span>
            </div>
            <div class="detail-meta-item">
                <strong>ุฃูุถูู ูู</strong>
                <span id="detail-createdAt">-</span>
            </div>
            <div class="detail-meta-item">
                <strong>ุฅุญุฏุงุซูุงุช</strong>
                <span id="detail-coords">-</span>
            </div>
            <div class="detail-actions">
                <button class="btn primary" onclick="centerOn(parseFloat(document.getElementById('detail-lat').value), parseFloat(document.getElementById('detail-lng').value), 14);">
                    <i class="fas fa-crosshairs"></i> ุชูุฌูู ุงูุฎุฑูุทุฉ
                </button>
                <input type="hidden" id="detail-lat">
                <input type="hidden" id="detail-lng">
            </div>
        </div>

        <div class="meta-footer" id="desktop-footer">ุชุนูู ุงูููุตุฉ ูุญููุงู โ ููุดุงุฑูุฉ ุงูููุงุท ุจูู ูุณุชุฎุฏููู ุชุญุชุงุฌ backend.</div>
    </div>
  </aside>

  <main class="mapwrap" role="main">
    <div id="map" aria-label="ุฎุฑูุทุฉ ุงูุฌุฒุงุฆุฑ"></div>

    <div class="map-controls" role="toolbar" aria-label="ุฃุฏูุงุช ุงูุฎุฑูุทุฉ">
      <button class="toggle" onclick="zoomToAlgeria()" title="ุฑูุฒ ุนูู ุงูุฌุฒุงุฆุฑ" aria-label="ุฑูุฒ ุนูู ุงูุฌุฒุงุฆุฑ"><i class="fas fa-globe"></i></button>
      <button class="toggle" onclick="fitAllMarkers()" title="ุงุธูุฑ ูู ุงูุนูุงูุงุช" aria-label="ุงุธูุฑ ูู ุงูุนูุงูุงุช"><i class="fas fa-layer-group"></i></button>
      <button class="toggle" id="toggleHeat" onclick="toggleHeatmap()" title="ุชุจุฏูู ุฎุฑูุทุฉ ุงูุญุฑุงุฑุฉ" aria-pressed="false" aria-label="ุชุจุฏูู ุฎุฑูุทุฉ ุงูุญุฑุงุฑุฉ"><i class="fas fa-fire"></i></button>
      <button class="toggle" id="toggleStyle" onclick="toggleStyle()" title="ุณูุฉ ุงูุฎุฑูุทุฉ" aria-pressed="false" aria-label="ุชุจุฏูู ุณูุฉ ุงูุฎุฑูุทุฉ"><i class="fas fa-adjust"></i></button>
    </div>

    <div class="fab-button" onclick="toggleSidebar(true, 'form-panel')" role="button" aria-label="ุฅุถุงูุฉ ุดุฌุฑุฉ ุฌุฏูุฏุฉ">
        <i class="fas fa-plus"></i>
    </div>

    <div class="toast" id="toast" style="opacity: 0;" role="alert" aria-live="assertive"></div>
  </main>

</div>

<div class="modal-overlay" id="editModalOverlay">
    <div class="modal-content" id="editModalContent" role="dialog" aria-modal="true" aria-labelledby="modal-edit-title">
        <button class="modal-close" onclick="closeModal()" aria-label="ุฅุบูุงู"><i class="fas fa-times"></i></button>
        <h3 id="modal-edit-title">ุชุนุฏูู ุงููุณุงููุฉ</h3>
        <form id="editForm">
            <input type="hidden" id="editId">
            <div class="field">
                <label for="editNom">ุงูุงุณู ุงููุงูู / ุงูุฌูุฉ <span class="required">*</span></label>
                <input id="editNom" type="text" required aria-required="true" />
            </div>
            <div class="field">
                <label for="editAdresse">ุงูููุทูุฉ / ุงูุนููุงู (ุงุฎุชูุงุฑู)</label>
                <input id="editAdresse" type="text" />
            </div>
            <div class="row">
                <div class="col field">
                    <label for="editTypeArbre">ููุน ุงูุดุฌุฑุฉ <span class="required">*</span></label>
                    <select id="editTypeArbre" required aria-required="true">
                        <option>ุตููุจุฑ ุญูุจู</option>
                        <option>ุฃุฑุฒ ุงูุฃุทูุณ</option>
                        <option>ุฒูุชูู</option>
                        <option>ูุฎูู</option>
                        <option>ุจููุท</option>
                        <option>ุฃุฎุฑู</option>
                    </select>
                </div>
                <div class="col field">
                    <label for="editQuantite">ุนุฏุฏ ุงูุฃุดุฌุงุฑ ุงููุฒุฑูุนุฉ <span class="required">*</span></label>
                    <input id="editQuantite" type="number" min="1" placeholder="ุงูุนุฏุฏ" required aria-required="true" />
                </div>
            </div>
             <div class="row">
                <div class="col field">
                    <label for="editDatePlanted">ุชุงุฑูุฎ ุงูุฒุฑุน</label>
                    <input id="editDatePlanted" type="date" />
                </div>
             </div>
             <div class="field">
                <label for="editPhoto">ุตูุฑุฉ ุจุนุฏ ุงูุฒุฑุน (ุงุฎุชูุงุฑู)</label>
                <input id="editPhoto" type="file" accept="image/*" />
                <div class="help-text">
                    <i class="fas fa-lightbulb"></i>
                    <span>ููููู ุงุฎุชูุงุฑ ุตูุฑุฉ ุฌุฏูุฏุฉ ูุงุณุชุจุฏุงู ุงูุตูุฑุฉ ุงูุญุงููุฉ</span>
                </div>
                <div id="editPhotoPreview" style="margin-top: 10px; display: none;">
                    <img id="editPhotoPreviewImg" src="" alt="ูุนุงููุฉ ุงูุตูุฑุฉ" style="max-width: 100%; max-height: 200px; border-radius: 8px; box-shadow: var(--shadow-sm);" />
                </div>
            </div>
             <div class="field location-group">
                <label>ูููุน ุงูุฒุฑุน <span class="required">*</span></label>
                <div class="row coords-inputs">
                    <input id="editLatitude" type="text" readonly placeholder="ุฎุท ุงูุนุฑุถ" required aria-required="true" />
                    <input id="editLongitude" type="text" readonly placeholder="ุฎุท ุงูุทูู" required aria-required="true" />
                </div>
                <small class="muted">ููููู ุณุญุจ ุงูุนูุงูุฉ ุนูู ุงูุฎุฑูุทุฉ ูุชุบููุฑ ุงููููุน.</small>
            </div>
            <div class="form-button-group">
                <button type="button" class="btn danger" onclick="removeEntry(document.getElementById('editId').value); closeModal();">
                    <i class="fas fa-trash-alt"></i> ุญุฐู ุงููุณุงููุฉ
                </button>
                <button type="submit" class="btn primary" id="saveEditBtn">
                    <i class="fas fa-save"></i> ุญูุธ ุงูุชุบููุฑุงุช
                </button>
            </div>
        </form>
    </div>
</div>




    <script src="../js/map.js"></script>
</body>
</html>